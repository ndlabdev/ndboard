model Card {
    id          String    @id @default(cuid(2))
    title       String
    description String?
    order       Int
    dueDate     DateTime?
    completed   Boolean   @default(false)
    archived    Boolean   @default(false)
    listId      String
    createdBy   String
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt

    // Relations
    list         List                   @relation(fields: [listId], references: [id])
    creator      User                   @relation("CardCreator", fields: [createdBy], references: [id])
    members      CardMember[]
    labels       CardLabel[]
    attachments  Attachment[]
    checklists   Checklist[]
    activities   Activity[]
    customFields CardCustomFieldValue[]
    comments     CardComment[]
    watchers     CardWatcher[]

    @@index([listId])
    @@index([createdBy])
}

model CardMember {
    cardId   String
    userId   String
    joinedAt DateTime @default(now())

    card Card @relation(fields: [cardId], references: [id])
    user User @relation(fields: [userId], references: [id])

    @@id([cardId, userId])
    @@index([userId])
}

model CardLabel {
    cardId  String
    labelId String

    card  Card  @relation(fields: [cardId], references: [id])
    label Label @relation(fields: [labelId], references: [id])

    @@id([cardId, labelId])
}

model Label {
    id        String   @id @default(cuid(2))
    name      String
    color     String // hex code (ex: #FF0000)
    boardId   String
    createdAt DateTime @default(now())

    board Board       @relation(fields: [boardId], references: [id])
    cards CardLabel[]

    @@index([boardId])
}

model Attachment {
    id         String   @id @default(cuid(2))
    url        String
    name       String
    size       Int?
    cardId     String
    uploadedBy String
    uploadedAt DateTime @default(now())

    card Card @relation(fields: [cardId], references: [id])
    user User @relation(fields: [uploadedBy], references: [id])
}

model Checklist {
    id     String          @id @default(cuid(2))
    cardId String
    title  String
    order  Int             @default(0)
    items  ChecklistItem[]

    card Card @relation(fields: [cardId], references: [id])
}

model ChecklistItem {
    id          String  @id @default(cuid(2))
    checklistId String
    title       String
    completed   Boolean @default(false)
    order       Int     @default(0)

    checklist Checklist @relation(fields: [checklistId], references: [id])
}

model Activity {
    id        String   @id @default(cuid(2))
    boardId   String?
    cardId    String
    userId    String
    type      String // e.g. 'COMMENT', 'MOVE', 'ASSIGN', 'ATTACH', ...
    detail    String?
    createdAt DateTime @default(now())

    card  Card   @relation(fields: [cardId], references: [id])
    user  User   @relation(fields: [userId], references: [id])
    Board Board? @relation(fields: [boardId], references: [id])
}

model CardCustomFieldValue {
    id      String @id @default(cuid(2))
    cardId  String
    fieldId String
    value   String

    card        Card        @relation(fields: [cardId], references: [id])
    customField CustomField @relation(fields: [fieldId], references: [id])
}

model CustomField {
    id        String   @id @default(cuid(2))
    boardId   String
    name      String
    type      String // e.g. 'text', 'number', 'date', 'select', ...
    options   String? // JSON string if type='select'
    createdAt DateTime @default(now())

    board  Board                  @relation(fields: [boardId], references: [id])
    values CardCustomFieldValue[]
}

model CardComment {
    id        String   @id @default(cuid(2))
    cardId    String
    userId    String
    content   String
    createdAt DateTime @default(now())

    card Card @relation(fields: [cardId], references: [id])
    user User @relation(fields: [userId], references: [id])
}

model CardWatcher {
    cardId String
    userId String

    card Card @relation(fields: [cardId], references: [id])
    user User @relation(fields: [userId], references: [id])

    @@id([cardId, userId])
}
